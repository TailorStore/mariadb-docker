[mysqld]
# Custom MariaDB configuration
# Connection and thread optimization for web applications
max_connections = 300
thread_cache_size = 50
max_connect_errors = 100000
connect_timeout = 10
wait_timeout = 300
interactive_timeout = 300

# InnoDB optimization (optimized for imports while production-safe)
innodb_buffer_pool_size = 512M
innodb_buffer_pool_instances = 4
innodb_log_file_size = 256M                    # Larger for better import performance
innodb_log_files_in_group = 2
innodb_log_buffer_size = 32M                   # Increased for bulk operations
innodb_flush_log_at_trx_commit = 2             # Safe for production, faster than 1
innodb_flush_method = O_DIRECT
innodb_file_per_table = ON
innodb_read_io_threads = 4
innodb_write_io_threads = 4
innodb_io_capacity = 400                       # Higher baseline for better performance
innodb_io_capacity_max = 800                   # Higher max capacity
innodb_lock_wait_timeout = 120                 # Longer timeout for bulk operations

# Query cache configuration (optimized for 2GB system)
query_cache_size = 128M
query_cache_limit = 16M
query_cache_type = ON

# Table and file handling optimization
table_open_cache = 2048
open_files_limit = 8192
table_definition_cache = 1024

# Memory tables and sorting optimization
tmp_table_size = 128M
max_heap_table_size = 128M
sort_buffer_size = 4M
read_buffer_size = 2M
read_rnd_buffer_size = 4M
join_buffer_size = 4M

# Key and index optimization
key_buffer_size = 32M
myisam_sort_buffer_size = 16M

# Enable binary logging for replication/backups
log-bin = mysql-bin
expire_logs_days = 7

# Performance Schema configuration
# Enable Performance Schema (MariaDB equivalent)
performance_schema = ON
performance_schema_max_table_instances = 400
performance_schema_max_table_handles = 1000
performance_schema_events_waits_history_size = 20
performance_schema_events_waits_history_long_size = 15000

# Character set configuration
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# Web application specific optimizations
sql_mode = STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
max_allowed_packet = 256M                      # Larger packets for imports
binlog_cache_size = 4M                         # Larger binary log cache
thread_stack = 256K
group_concat_max_len = 2048000
bulk_insert_buffer_size = 32M                  # Better bulk insert performance

# Slow query logging for optimization
slow_query_log = ON
long_query_time = 2
slow_query_log_file = /var/log/mysql/slow.log

[mysql]
default-character-set = utf8mb4

[client]
default-character-set = utf8mb4
